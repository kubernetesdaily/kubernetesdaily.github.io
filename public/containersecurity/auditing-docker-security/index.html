<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Demestifying Container and Orchestration Ecosystem">
<meta name="author" content="CloudNativeFolks">

<title>Auditing Docker Security ¬∑ kubedaily</title>

<link rel="canonical" href="https://kubedaily.com/containersecurity/auditing-docker-security/">









<link rel="stylesheet" href="/scss/base.css" integrity="">



<link rel="stylesheet" href="/scss/theme/default.css" integrity="">



  <link rel="preconnect" href="https://-dsn.algolia.net" crossorigin />
  
  <link rel="stylesheet" href="/scss/component/docsearch.css" integrity=""/>

<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/img/icon/favicon.ico">
<link rel="icon" href="/img/icon/icon-16.png" sizes="16x16" type="image/png">
<link rel="icon" href="/img/icon/icon-32.png" sizes="32x32" type="image/png">
<link rel="apple-touch-icon" href="/img/icon/icon-180.png" sizes="180x180">
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', '');
</script>
    <script 
     src="https://cdn.jsdelivr.net/npm/quizdown@latest/public/build/quizdown.js">
  </script>
  <script 
      src="https://cdn.jsdelivr.net/npm/quizdown@latest/public/build/extensions/quizdownKatex.js">
  </script>
  <script 
      src="https://cdn.jsdelivr.net/npm/quizdown@latest/public/build/extensions/quizdownHighlight.js">
  </script>
  <script>quizdown.register(quizdownHighlight).register(quizdownKatex).init()</script> 
  </head>
  <body>
    <header id="site-header">
  
  <div id="site-header-brand">
    <a href="/">kubedaily</a>
  </div>

  
  <div id="site-header-controls">
    
    <div class="dropdown">
      <button class="dropdown-btn" aria-haspopup="menu" aria-label="theme selector">
        <i class="icon icon-brightness"></i>
        <i class="icon icon-select"></i>
      </button>
      <ul role="menu" class="dropdown-menu">
        <li role="menuitem"><button class="color-scheme" data-value="light"><i class="icon icon-light-mode"></i> Light</button></li>
        <li role="menuitem"><button class="color-scheme" data-value="dark"><i class="icon icon-dark-mode"></i> Dark &nbsp;</button></li>
        <li role="menuitem"><button class="color-scheme" data-value="night"><i class="icon icon-night-mode"></i> Night</button></li>
      </ul>
    </div>

    
    <div class="dropdown">
      <button class="dropdown-btn" aria-haspopup="menu" aria-label="language selector">
        <i class="icon icon-translate"></i>
        <i class="icon icon-select"></i>
      </button>
      <ul role="menu" class="dropdown-menu">
        
          <li role="menuitem"><a href="#">English</a></li>
        
      </ul>
    </div>
  </div>

  
  <div id="site-header-menu">
    <nav>
      <ul>
        
        
        
          
          <li><a href="/" ><i class='icon icon-home'></i>Home</a></li>
        
          
          <li><a href="/docker/" ><i class='icon icons8-docker '></i>Docker</a></li>
        
          
          <li><a href="/containersecurity/"  class="active"><i class='icon icon-book'></i>ContainerSecurity</a></li>
        
          
          <li><a href="/k8s/" ><i class='icon icons8-kubernetes'></i>Kubernetes</a></li>
        
          
          <li><a href="/blog/" ><i class='icon icon-book'></i>blog</a></li>
        
          
          <li><a href="https://kubedaily.com/cloudnativetools/" ><i class='icon icon-book'></i>cloudnativetools</a></li>
        
      </ul>
    </nav>
  </div>

  

</header>
    
<div id="site-main-content-wrapper">
  
  
    <aside id="sidebar">
  <span class="btn-close"><i class="icon icon-close"></i></span>

  <div class="sticky"><strong class="sidebar-section">Container Security</strong>
          
          <a class="sidebar-link " href="/containersecurity/overview/">
            
              Overview
            
          </a>

        <strong class="sidebar-section">üîíContainerSecurity</strong>
          
          <a class="sidebar-link " href="/containersecurity/what-is-container/">
            
              What is container?
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/container-vs-virtualization/">
            
              Container vs Virtualization
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/namespaces/">
            
              Namespaces
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/cgroups/">
            
              Cgroups
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/capabilities/">
            
              Capabilities
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/docker-architecture-and-its-components/">
            
              Docker architecture and its components
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/interacting-with-container-ecosystem/">
            
              Interacting with container ecosystem
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/attack-surface-of-the-container-ecosystem/">
            
              Attack surface of the container ecosystem
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/docker-volumes/">
            
              Docker volumes
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/docker-networking/">
            
              Docker Networking
            
          </a>

        
          
          <a class="sidebar-link current" href="/containersecurity/auditing-docker-security/">
            
              Auditing Docker Security
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/container-image-security/">
            
              Container Image Security
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/dockerfile-security-best-practices/">
            
              DockerFile Security Best Practices
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/secretscanner-finding-secrets-and-passwords-in-container-images-and-file-systems/">
            
              SecretScanner - Finding secrets and passwords in container images and file systems
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/yarahunter-malware-scanner-for-container-images/">
            
              YaraHunter - Malware Scanner for Container Images
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/security-linting-of-dockerfiles/">
            
              Security Linting of Dockerfiles
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/static-analysis-of-container-images-library-for-container/">
            
              Static Analysis of container images library for container
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/docker-host-security-configurations/">
            
              Docker host security configurations
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/docker-daemon-security-configurations/">
            
              Docker Daemon security configurations
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/content-trust-and-integrity-checks/">
            
              Content Trust and Integrity checks
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/docker-registry-security-configurations/">
            
              Docker Registry security configurations
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/dockerscan/">
            
              DockerScan
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/dive/">
            
              Dive
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity/docker-events/">
            
              Docker events
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity//">
            
              
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity//">
            
              
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity//">
            
              
            
          </a>

        
          
          <a class="sidebar-link " href="/containersecurity//">
            
              
            
          </a>

        
  </div>
</aside>
  
  <main>
    <article id="article">
      <nav id="article-nav">
  <button id="article-nav-menu-btn"><i class="icon icon-menu"></i> On this section</button>
  <button id="article-nav-toc-btn"><i class="icon icon-toc"></i> On this page</button>
</nav>
      <header id="article-header">
  <h1>Auditing Docker Security</h1>
</header>
      <div id="article-content">
        
        
        <h2 id="auditing-docker-security">Auditing Docker Security</h2>
<p>DOCKER BENCH FOR SECURITY</p>
<p>Docker Bench for Security is an open source Bash script that checks for various common security best practices of deploying Docker in production environments. The tests are all automated and are based on the CIS Docker Benchmark. More information about Docker Bench for Security can be found
on GitHub: <a href="https://github.com/docker/docker-bench-security" target="_blank">https://github.com/docker/docker-bench-security</a></p>
<h2 id="auditing-docker-security-with-docker-bench-for-security">auditing docker security with docker bench for security</h2>
<p>The auditing process can be performed by following the procedures outlined below:</p>
<p>You first need to clone the docker/docker-bench-security GitHub repository on your Docker host. This can be done by running the following command:</p>
<pre tabindex="0"><code>git clone https://github.com/docker/docker-bench-security.git
</code></pre><p>After cloning the repository, you will need to navigate into the docker-bench-security repository that you just cloned:</p>
<pre tabindex="0"><code>cd docker-bench-security
</code></pre><p>The cloned directory will contain a Bash script named docker-bench-security.sh. We can run this script to perform the Docker security audit by running the following command:</p>
<pre tabindex="0"><code>sudo ./docker-bench-security.sh
</code></pre><p>When the script is executed, it will perform all the necessary security checks. Once completed, it will provide you with a baseline security score as highlighted</p>
<pre tabindex="0"><code>Section C - Score

[INFO] Checks: 117
[INFO] Score: -5
</code></pre><h1 id="docker-bench-for-security-options">Docker Bench for Security Options</h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">   b           optional  Do not print colors
</span></span><span class="line"><span class="cl">  -h           optional  Print this <span class="nb">help</span> message
</span></span><span class="line"><span class="cl">  -l FILE      optional  Log output in FILE, inside container <span class="k">if</span> run using docker
</span></span><span class="line"><span class="cl">  -u USERS     optional  Comma delimited list of trusted docker user<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">  -c CHECK     optional  Comma delimited list of specific check<span class="o">(</span>s<span class="o">)</span> id
</span></span><span class="line"><span class="cl">  -e CHECK     optional  Comma delimited list of specific check<span class="o">(</span>s<span class="o">)</span> id to exclude
</span></span><span class="line"><span class="cl">  -i INCLUDE   optional  Comma delimited list of patterns within a container or image name to check
</span></span><span class="line"><span class="cl">  -x EXCLUDE   optional  Comma delimited list of patterns within a container or image name to exclude from check
</span></span><span class="line"><span class="cl">  -n LIMIT     optional  In JSON output, when reporting lists of items <span class="o">(</span>containers, images, etc.<span class="o">)</span>, limit the number of reported items to LIMIT. Default <span class="m">0</span> <span class="o">(</span>no limit<span class="o">)</span>.
</span></span><span class="line"><span class="cl">  -p PRINT     optional  Disable the printing of remediation measures. Default: print remediation measures.
</span></span></code></pre></div><h2 id="running-docker-bench-for-poticular-docker-images">Running Docker Bench for poticular docker images</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo ./docker-bench-security.sh -i hello-world
</span></span><span class="line"><span class="cl">Password:
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Docker Bench for Security v1.3.6</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Docker, Inc. (c) 2015-2023</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Checks for dozens of common best-practices around deploying Docker containers in production.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Based on the CIS Docker Benchmark 1.4.0.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Initializing 2023-01-04T19:09:21:z
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Section A - Check results
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> <span class="m">1</span> - Host Configuration
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1 - Linux Hosts Specific Configuration
</span></span><span class="line"><span class="cl"><span class="o">[</span>WARN<span class="o">]</span> 1.1.1 - Ensure a separate partition <span class="k">for</span> containers has been created <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.2 - Ensure only trusted users are allowed to control Docker daemon <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>       * Users: 
</span></span><span class="line"><span class="cl"><span class="o">[</span>WARN<span class="o">]</span> 1.1.3 - Ensure auditing is configured <span class="k">for</span> the Docker daemon <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>WARN<span class="o">]</span> 1.1.4 - Ensure auditing is configured <span class="k">for</span> Docker files and directories -/run/containerd <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.5 - Ensure auditing is configured <span class="k">for</span> Docker files and directories - /var/lib/docker <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>        * Directory not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.6 - Ensure auditing is configured <span class="k">for</span> Docker files and directories - /etc/docker <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>        * Directory not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.7 - Ensure auditing is configured <span class="k">for</span> Docker files and directories - docker.service <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>        * File not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.8 - Ensure auditing is configured <span class="k">for</span> Docker files and directories - containerd.sock <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>        * File not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.9 - Ensure auditing is configured <span class="k">for</span> Docker files and directories - docker.socket <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>        * File not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.10 - Ensure auditing is configured <span class="k">for</span> Docker files and directories - /etc/default/docker <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>        * File not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.11 - Ensure auditing is configured <span class="k">for</span> Dockerfiles and directories - /etc/docker/daemon.json <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>        * File not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.12 - 1.1.12 Ensure auditing is configured <span class="k">for</span> Dockerfiles and directories - /etc/containerd/config.toml <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>        * File not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.13 - Ensure auditing is configured <span class="k">for</span> Docker files and directories - /etc/sysconfig/docker <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>        * File not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.14 - Ensure auditing is configured <span class="k">for</span> Docker files and directories - /usr/bin/containerd <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>         * File not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.15 - Ensure auditing is configured <span class="k">for</span> Docker files and directories - /usr/bin/containerd-shim <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>         * File not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.16 - Ensure auditing is configured <span class="k">for</span> Docker files and directories - /usr/bin/containerd-shim-runc-v1 <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>         * File not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.17 - Ensure auditing is configured <span class="k">for</span> Docker files and directories - /usr/bin/containerd-shim-runc-v2 <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>         * File not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.1.18 - Ensure auditing is configured <span class="k">for</span> Docker files and directories - /usr/bin/runc <span class="o">(</span>Automated<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>         * File not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 1.2 - General Configuration
</span></span><span class="line"><span class="cl"><span class="o">[</span>NOTE<span class="o">]</span> 1.2.1 - Ensure the container host has been Hardened <span class="o">(</span>Manual<span class="o">)</span>
</span></span><span class="line"><span class="cl">date: illegal <span class="nb">time</span> format
</span></span><span class="line"><span class="cl">usage: date <span class="o">[</span>-jnRu<span class="o">]</span> <span class="o">[</span>-r seconds<span class="p">|</span>file<span class="o">]</span> <span class="o">[</span>-v<span class="o">[</span>+<span class="p">|</span>-<span class="o">]</span>val<span class="o">[</span>ymwdHMS<span class="o">]]</span>
</span></span><span class="line"><span class="cl">            <span class="o">[</span>-I<span class="o">[</span>date <span class="p">|</span> hours <span class="p">|</span> minutes <span class="p">|</span> seconds<span class="o">]]</span>
</span></span><span class="line"><span class="cl">            <span class="o">[</span>-f fmt date <span class="p">|</span> <span class="o">[[[</span>mm<span class="o">]</span>dd<span class="o">]</span>HH<span class="o">]</span>MM<span class="o">[[</span>cc<span class="o">]</span>yy<span class="o">][</span>.ss<span class="o">]]</span> <span class="o">[</span>+format<span class="o">]</span>
</span></span><span class="line"><span class="cl">./functions/helper_lib.sh: line 36: <span class="o">[</span>: : integer expression expected
</span></span><span class="line"><span class="cl">./functions/helper_lib.sh: line 37: <span class="o">[</span>: : integer expression expected
</span></span><span class="line"><span class="cl"><span class="o">[</span>PASS<span class="o">]</span> 1.2.2 - Ensure that the version of Docker is up to date <span class="o">(</span>Manual<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>        * Using 20.10.21 which is current
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>        * Check with your operating system vendor <span class="k">for</span> support and security maintenance <span class="k">for</span> Docker
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> <span class="m">2</span> - Docker daemon configuration
</span></span><span class="line"><span class="cl"><span class="o">[</span>NOTE<span class="o">]</span> 2.1 - Run the Docker daemon as a non-root user, <span class="k">if</span> possible <span class="o">(</span>Manual<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>WARN<span class="o">]</span> 2.2 - Ensure network traffic is restricted between containers on the default bridge <span class="o">(</span>Scored<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>PASS<span class="o">]</span> 2.3 - Ensure the logging level is <span class="nb">set</span> to <span class="s1">&#39;info&#39;</span> <span class="o">(</span>Scored<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>PASS<span class="o">]</span> 2.4 - Ensure Docker is allowed to make changes to iptables <span class="o">(</span>Scored<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>PASS<span class="o">]</span> 2.5 - Ensure insecure registries are not used <span class="o">(</span>Scored<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>PASS<span class="o">]</span> 2.6 - Ensure aufs storage driver is not used <span class="o">(</span>Scored<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 2.7 - Ensure TLS authentication <span class="k">for</span> Docker daemon is configured <span class="o">(</span>Scored<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>      * Docker daemon not listening on TCP
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> 2.8 - Ensure the default <span class="nb">ulimit</span> is configured appropriately <span class="o">(</span>Manual<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span>      * Default <span class="nb">ulimit</span> doesn<span class="s1">&#39;t appear to be set
</span></span></span><span class="line"><span class="cl"><span class="s1">[WARN] 2.9 - Enable user namespace support (Scored)
</span></span></span><span class="line"><span class="cl"><span class="s1">[PASS] 2.10 - Ensure the default cgroup usage has been confirmed (Scored)
</span></span></span><span class="line"><span class="cl"><span class="s1">[PASS] 2.11 - Ensure base device size is not changed until needed (Scored)
</span></span></span><span class="line"><span class="cl"><span class="s1">[WARN] 2.12 - Ensure that authorization for Docker client commands is enabled (Scored)
</span></span></span><span class="line"><span class="cl"><span class="s1">[WARN] 2.13 - Ensure centralized and remote logging is configured (Scored)
</span></span></span><span class="line"><span class="cl"><span class="s1">[WARN] 2.14 - Ensure containers are restricted from acquiring new privileges (Scored)
</span></span></span><span class="line"><span class="cl"><span class="s1">[WARN] 2.15 - Ensure live restore is enabled (Scored)
</span></span></span><span class="line"><span class="cl"><span class="s1">[WARN] 2.16 - Ensure Userland Proxy is Disabled (Scored)
</span></span></span><span class="line"><span class="cl"><span class="s1">[PASS] 2.17 - Ensure that a daemon-wide custom seccomp profile is applied if appropriate (Manual)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] Ensure that experimental features are not implemented in production (Scored) (Deprecated)
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3 - Docker daemon configuration files
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.1 - Ensure that the docker.service file ownership is set to root:root (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * File not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.2 - Ensure that docker.service file permissions are appropriately set (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * File not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.3 - Ensure that docker.socket file ownership is set to root:root (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * File not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.4 - Ensure that docker.socket file permissions are set to 644 or more restrictive (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * File not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.5 - Ensure that the /etc/docker directory ownership is set to root:root (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * Directory not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.6 - Ensure that /etc/docker directory permissions are set to 755 or more restrictively (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * Directory not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.7 - Ensure that registry certificate file ownership is set to root:root (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * Directory not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.8 - Ensure that registry certificate file permissions are set to 444 or more restrictively (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * Directory not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.9 - Ensure that TLS CA certificate file ownership is set to root:root (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * No TLS CA certificate found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.10 - Ensure that TLS CA certificate file permissions are set to 444 or more restrictively (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * No TLS CA certificate found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.11 - Ensure that Docker server certificate file ownership is set to root:root (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * No TLS Server certificate found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.12 - Ensure that the Docker server certificate file permissions are set to 444 or more restrictively (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * No TLS Server certificate found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.13 - Ensure that the Docker server certificate key file ownership is set to root:root (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * No TLS Key found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.14 - Ensure that the Docker server certificate key file permissions are set to 400 (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * No TLS Key found
</span></span></span><span class="line"><span class="cl"><span class="s1">stat: illegal option -- c
</span></span></span><span class="line"><span class="cl"><span class="s1">usage: stat [-FLnq] [-f format | -l | -r | -s | -x] [-t timefmt] [file ...]
</span></span></span><span class="line"><span class="cl"><span class="s1">[WARN] 3.15 - Ensure that the Docker socket file ownership is set to root:docker (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[WARN]       * Wrong ownership for /var/run/docker.sock
</span></span></span><span class="line"><span class="cl"><span class="s1">stat: illegal option -- c
</span></span></span><span class="line"><span class="cl"><span class="s1">usage: stat [-FLnq] [-f format | -l | -r | -s | -x] [-t timefmt] [file ...]
</span></span></span><span class="line"><span class="cl"><span class="s1">./tests/3_docker_daemon_configuration_files.sh: line 429: [: : integer expression expected
</span></span></span><span class="line"><span class="cl"><span class="s1">[WARN] 3.16 - Ensure that the Docker socket file permissions are set to 660 or more restrictively (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[WARN]       * Wrong permissions for /var/run/docker.sock
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.17 - Ensure that the daemon.json file ownership is set to root:root (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * File not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.18 - Ensure that daemon.json file permissions are set to 644 or more restrictive (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * File not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.19 - Ensure that the /etc/default/docker file ownership is set to root:root (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * File not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.20 - Ensure that the /etc/sysconfig/docker file permissions are set to 644 or more restrictively (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * File not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.21 - Ensure that the /etc/sysconfig/docker file ownership is set to root:root (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * File not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.22 - Ensure that the /etc/default/docker file permissions are set to 644 or more restrictively (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * File not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.23 - Ensure that the Containerd socket file ownership is set to root:root (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * File not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 3.24 - Ensure that the Containerd socket file permissions are set to 660 or more restrictively (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]       * File not found
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 4 - Container Images and Build File
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 4.1 - Ensure that a user for the container has been created (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * No containers running
</span></span></span><span class="line"><span class="cl"><span class="s1">[NOTE] 4.2 - Ensure that containers use only trusted base images (Manual)
</span></span></span><span class="line"><span class="cl"><span class="s1">[NOTE] 4.3 - Ensure that unnecessary packages are not installed in the container (Manual)
</span></span></span><span class="line"><span class="cl"><span class="s1">[NOTE] 4.4 - Ensure images are scanned and rebuilt to include security patches (Manual)
</span></span></span><span class="line"><span class="cl"><span class="s1">[WARN] 4.5 - Ensure Content trust for Docker is Enabled (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[PASS] 4.6 - Ensure that HEALTHCHECK instructions have been added to container images (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[PASS] 4.7 - Ensure update instructions are not used alone in the Dockerfile (Manual)
</span></span></span><span class="line"><span class="cl"><span class="s1">[NOTE] 4.8 - Ensure setuid and setgid permissions are removed (Manual)
</span></span></span><span class="line"><span class="cl"><span class="s1">[PASS] 4.9 - Ensure that COPY is used instead of ADD in Dockerfiles (Manual)
</span></span></span><span class="line"><span class="cl"><span class="s1">[NOTE] 4.10 - Ensure secrets are not stored in Dockerfiles (Manual)
</span></span></span><span class="line"><span class="cl"><span class="s1">[NOTE] 4.11 - Ensure only verified packages are installed (Manual)
</span></span></span><span class="line"><span class="cl"><span class="s1">[NOTE] 4.12 - Ensure all signed artifacts are validated (Manual)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 5 - Container Runtime
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]   * No containers running, skipping Section 5
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 6 - Docker Security Operations
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 6.1 - Ensure that image sprawl is avoided (Manual)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * There are currently: 13 images
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * Only 0 out of 13 are in use
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 6.2 - Ensure that container sprawl is avoided (Manual)
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO]      * There are currently a total of 40 containers, with 18 of them currently running
</span></span></span><span class="line"><span class="cl"><span class="s1">[INFO] 7 - Docker Swarm Configuration
</span></span></span><span class="line"><span class="cl"><span class="s1">[PASS] 7.1 - Ensure swarm mode is not Enabled, if not needed (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[PASS] 7.2 - Ensure that the minimum number of manager nodes have been created in a swarm (Automated) (Swarm mode not enabled)
</span></span></span><span class="line"><span class="cl"><span class="s1">[PASS] 7.3 - Ensure that swarm services are bound to a specific host interface (Automated) (Swarm mode not enabled)
</span></span></span><span class="line"><span class="cl"><span class="s1">[PASS] 7.4 - Ensure that all Docker swarm overlay networks are encrypted (Automated)
</span></span></span><span class="line"><span class="cl"><span class="s1">[PASS] 7.5 - Ensure that Docker&#39;</span>s secret management commands are used <span class="k">for</span> managing secrets in a swarm cluster <span class="o">(</span>Manual<span class="o">)</span> <span class="o">(</span>Swarm mode not enabled<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>PASS<span class="o">]</span> 7.6 - Ensure that swarm manager is run in auto-lock mode <span class="o">(</span>Automated<span class="o">)</span> <span class="o">(</span>Swarm mode not enabled<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>PASS<span class="o">]</span> 7.7 - Ensure that the swarm manager auto-lock key is rotated periodically <span class="o">(</span>Manual<span class="o">)</span> <span class="o">(</span>Swarm mode not enabled<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>PASS<span class="o">]</span> 7.8 - Ensure that node certificates are rotated as appropriate <span class="o">(</span>Manual<span class="o">)</span> <span class="o">(</span>Swarm mode not enabled<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>PASS<span class="o">]</span> 7.9 - Ensure that CA certificates are rotated as appropriate <span class="o">(</span>Manual<span class="o">)</span> <span class="o">(</span>Swarm mode not enabled<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>PASS<span class="o">]</span> 7.10 - Ensure that management plane traffic is separated from data plane traffic <span class="o">(</span>Manual<span class="o">)</span> <span class="o">(</span>Swarm mode not enabled<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Section C - Score
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> Checks: <span class="m">86</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> Score: -1
</span></span></code></pre></div><h1 id="run-the-docker-daemon-as-a-non-root-user-if-possible-manual">Run the Docker daemon as a non-root user, if possible (Manual)</h1>
<p>The Docker containers by default run with the root privilege and so does the application that runs inside the container. This is another major concern from the security perspective because hackers can gain root access to the Docker host by hacking the application running inside the container.</p>
<p>Add user to Docker group</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo groupadd docker
</span></span></code></pre></div><p>add your user to the docker group:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo usermod -aG docker <span class="o">[</span>non-root user<span class="o">]</span>
</span></span></code></pre></div><p>Using Dockerfile (USER instruction)</p>
<p>dit the Dockerfile that creates a non-root privilege user and modify the default root user to the newly-created non-root privilege user, as shown here:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">##########################################</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Dockerfile to change from root to </span>
</span></span><span class="line"><span class="cl"><span class="c1"># non-root privilege</span>
</span></span><span class="line"><span class="cl"><span class="c1">###########################################</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Base image is CentOS 7</span>
</span></span><span class="line"><span class="cl">FROM Centos:7
</span></span><span class="line"><span class="cl"><span class="c1"># Add a new user &#34;sangam&#34; with user id 8877</span>
</span></span><span class="line"><span class="cl">RUN useradd -u <span class="m">8877</span> sangam
</span></span><span class="line"><span class="cl"><span class="c1"># Change to non-root privilege</span>
</span></span><span class="line"><span class="cl">USER sangam
</span></span></code></pre></div><p>Proceed to build the Docker image using the ‚Äúdocker build‚Äù subcommand, as depicted here:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo docker build -t nonrootimage .
</span></span></code></pre></div><p>Finally, let‚Äôs verify the current user of our container using the id command in a docker run subcommand:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo docker run --rm nonrootimage id
</span></span></code></pre></div><h1 id="ensure-network-traffic-is-restricted-between-containers-on-the-default-bridge">Ensure network traffic is restricted between containers on the default bridge</h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo docker network ls 
</span></span><span class="line"><span class="cl">Password:
</span></span><span class="line"><span class="cl">NETWORK ID     NAME                                                         DRIVER    SCOPE
</span></span><span class="line"><span class="cl">beb64c03a4cf   bridge                                                       bridge    <span class="nb">local</span>
</span></span><span class="line"><span class="cl">1d337b15d114   host                                                         host      <span class="nb">local</span>
</span></span><span class="line"><span class="cl">88ea4badd709   meshery_docker-extension-meshery-desktop-extension_default   bridge    <span class="nb">local</span>
</span></span><span class="line"><span class="cl">3be4c0abf1a8   minikube                                                     bridge    <span class="nb">local</span>
</span></span><span class="line"><span class="cl">47444c7b3650   multinode-pod-security                                       bridge    <span class="nb">local</span>
</span></span><span class="line"><span class="cl">ed5ab538e49a   none                                                         null      <span class="nb">local</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo docker network inspect bridge
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Password:
</span></span><span class="line"><span class="cl"><span class="o">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;bridge&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Id&#34;</span>: <span class="s2">&#34;beb64c03a4cf6c3385fd311edf8a3ff76670f62045068bad43ad4fcfe40f5c72&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Created&#34;</span>: <span class="s2">&#34;2023-01-04T11:46:52.643189959Z&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Scope&#34;</span>: <span class="s2">&#34;local&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Driver&#34;</span>: <span class="s2">&#34;bridge&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;EnableIPv6&#34;</span>: false,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;IPAM&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Driver&#34;</span>: <span class="s2">&#34;default&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Options&#34;</span>: null,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Config&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">                <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;Subnet&#34;</span>: <span class="s2">&#34;172.17.0.0/16&#34;</span>,
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;Gateway&#34;</span>: <span class="s2">&#34;172.17.0.1&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">]</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Internal&#34;</span>: false,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Attachable&#34;</span>: false,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Ingress&#34;</span>: false,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ConfigFrom&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Network&#34;</span>: <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ConfigOnly&#34;</span>: false,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Containers&#34;</span>: <span class="o">{}</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Options&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;com.docker.network.bridge.default_bridge&#34;</span>: <span class="s2">&#34;true&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;com.docker.network.bridge.enable_icc&#34;</span>: <span class="s2">&#34;true&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;com.docker.network.bridge.enable_ip_masquerade&#34;</span>: <span class="s2">&#34;true&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;com.docker.network.bridge.host_binding_ipv4&#34;</span>: <span class="s2">&#34;0.0.0.0&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;com.docker.network.bridge.name&#34;</span>: <span class="s2">&#34;docker0&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;com.docker.network.driver.mtu&#34;</span>: <span class="s2">&#34;1500&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Labels&#34;</span>: <span class="o">{}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">]</span>
</span></span></code></pre></div><p>If not required, you should restrict the network traffic between containers.</p>
<p>By default, unrestricted network traffic is enabled amongst all containers on the same host in the default network bridge. However, a bad actor positioned in a compromised container could leverage this functionality to abuse other services exposed by other containers within the container network on the same host.</p>
<p>To disable the inter-container communication, configure the daemon with the icc flag set to false. Note that this configuration can be overridden by containers that are run with the deprecated &ndash;link option.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker network ls -q <span class="p">|</span> xargs docker network inspect -f <span class="s1">&#39;{{ .Name }}: {{ .Options }}&#39;</span>
</span></span></code></pre></div><p>The com.docker.network.bridge.enable_icc should be set to false for the default network bridge.</p>
<p>You should also consider using user-defined bridge networks to enforce network isolation among containers as a more flexible solution.</p>
<h1 id="protect-the-unix-socket-from-unintended-access">Protect the UNIX socket from unintended access</h1>
<p>The non-networked /var/run/docker.sock UNIX socket is used by default to locally access the Docker Engine API. The safe default settings on Linux include a socket file owned by the ‚Äúroot‚Äù user and a ‚Äúdocker‚Äù group allowing solely ‚Äúroot‚Äù read and write file permission (ug+rw).</p>
<p>Run this command to review the correctness of the Docker UNIX socket permissions.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls -l /var/run/docker.sock
</span></span><span class="line"><span class="cl">lrwxr-xr-x  <span class="m">1</span> root  daemon  <span class="m">44</span>  <span class="m">4</span> Jan 17:16 /var/run/docker.sock -&gt; /Users/sangambiradar/.docker/run/docker.sock
</span></span></code></pre></div><h1 id="use-secure-registries-to-pull-and-push-images">Use secure registries to pull and push images</h1>
<p>nsecure registries do not use TLS, nor do they have an invalid TLS certificate. Such registries should not be used as they are prone to man-in-the-middle (MITM) attacks by malicious actors who are able to modify the network traffic.</p>
<p>Run the below command to list the insecure registries used by the Docker daemon.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker info --format <span class="s1">&#39;{{.RegistryConfig.InsecureRegistryCIDRs}}&#39;</span>
</span></span></code></pre></div><h1 id="enable-user-namespace-support">Enable user namespace support</h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ps aux <span class="p">|</span> grep dockerd
</span></span><span class="line"><span class="cl">sangambiradar    <span class="m">34266</span>   0.0  0.0 <span class="m">408626880</span>   <span class="m">1280</span> s000  S+    7:22PM   0:00.00 grep --color<span class="o">=</span>auto --exclude-dir<span class="o">=</span>.bzr --exclude-dir<span class="o">=</span>CVS --exclude-dir<span class="o">=</span>.git --exclude-dir<span class="o">=</span>.hg --exclude-dir<span class="o">=</span>.svn --exclude-dir<span class="o">=</span>.idea --exclude-dir<span class="o">=</span>.tox dockerd
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker container run -it --rm alpine /bin/sh
</span></span><span class="line"><span class="cl">Unable to find image <span class="s1">&#39;alpine:latest&#39;</span> locally
</span></span><span class="line"><span class="cl">latest: Pulling from library/alpine
</span></span><span class="line"><span class="cl">261da4162673: Pull <span class="nb">complete</span> 
</span></span><span class="line"><span class="cl">Digest: sha256:8914eb54f968791faf6a8638949e480fef81e697984fba772b3976835194c6d4
</span></span><span class="line"><span class="cl">Status: Downloaded newer image <span class="k">for</span> alpine:latest
</span></span><span class="line"><span class="cl">/ <span class="c1"># whoami </span>
</span></span><span class="line"><span class="cl">root
</span></span></code></pre></div><p>To follow the principle of least privilege, containerized applications should not be run as root. To achieve this, then the &ndash;user parameter can be used to specify a user other than root for the container. It accepts as value a username (if it was previously created in the Dockerfile) or a UID, optionally a GID as well.</p>
<h2 id="enable-content-trust">Enable Content Trust</h2>
<p>Ensure Content trust for Docker is Enabled. Content trust is a system for signing Docker images and verifying their signatures before running them. We can enable content trust with the <code>DOCKER_CONTENT_TRUST</code> environment variable.</p>
<p>To set this variable for your current shell
session, type the following into the shell:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST</span><span class="o">=</span><span class="m">1</span>
</span></span></code></pre></div><p>Running the audit after this export command should show that Content trust has been enabled and clear this warning. To enable it automatically for all users and all sessions, add the <code>DOCKER_CONTENT_TRUST</code> variable to the <code>/etc/environment</code> file, which is a file for assigning system-wide environment variables:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;DOCKER_CONTENT_TRUST=1&#34;</span> <span class="p">|</span> sudo tee -a /etc/environment
</span></span></code></pre></div><h2 id="ensure-auditing-is-configured-for-various-docker-files">Ensure auditing is configured for various Docker files</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt-get install auditd
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo nano /etc/audit/audit.rules
</span></span><span class="line"><span class="cl">ubuntu@enormous-longspur:~$ sudo cat  /etc/audit/audit.rules
</span></span><span class="line"><span class="cl"><span class="c1">## This file is automatically generated from /etc/audit/rules.d</span>
</span></span><span class="line"><span class="cl">-D
</span></span><span class="line"><span class="cl">-b <span class="m">8192</span>
</span></span><span class="line"><span class="cl">-f <span class="m">1</span>
</span></span><span class="line"><span class="cl">--backlog_wait_time <span class="m">60000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-w /usr/bin/docker -p wa
</span></span><span class="line"><span class="cl">-w /var/lib/docker -p wa
</span></span><span class="line"><span class="cl">-w /etc/docker -p wa
</span></span><span class="line"><span class="cl">-w /lib/systemd/system/docker.service -p wa
</span></span><span class="line"><span class="cl">-w /lib/systemd/system/docker.socket -p wa
</span></span><span class="line"><span class="cl">-w /etc/default/docker -p wa
</span></span><span class="line"><span class="cl">-w /etc/docker/daemon.json -p wa
</span></span><span class="line"><span class="cl">-w /usr/bin/docker-containerd -p wa
</span></span><span class="line"><span class="cl">-w /usr/bin/docker-runc -p wa
</span></span></code></pre></div><p>Restart auditd for the changes to take effect:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo systemctl restart auditd
</span></span></code></pre></div><h2 id="correcting-docker-daemon-configuration-warnings">Correcting Docker Daemon Configuration Warnings</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo nano /etc/docker/daemon.json
</span></span><span class="line"><span class="cl">ubuntu@docker:~/docker-bench-security$ cat nano /etc/docker/daemon.json
</span></span><span class="line"><span class="cl">cat: nano: No such file or directory
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;icc&#34;</span>: false,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;userns-remap&#34;</span>: <span class="s2">&#34;default&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;log-driver&#34;</span>: <span class="s2">&#34;syslog&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;disable-legacy-registry&#34;</span>: true,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;live-restore&#34;</span>: true,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;userland-proxy&#34;</span>: false,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;no-new-privileges&#34;</span>: <span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">ubuntu@docker:~/docker-bench-security$ 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo systemctl restart docker
</span></span></code></pre></div><h2 id="enable-content-trust-1">Enable Content Trust</h2>
<p>Content trust is a system for signing Docker images and verifying their signatures before running them. We can enable content trust with the DOCKER_CONTENT_TRUST environment variable.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST</span><span class="o">=</span><span class="m">1</span>
</span></span></code></pre></div><p>Running the audit after this export command should show that Content trust has been enabled and clear this warning. To enable it automatically for all users and all sessions, add the DOCKER_CONTENT_TRUST variable to the /etc/environment file, which is a file for assigning system-wide environment variables:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;DOCKER_CONTENT_TRUST=1&#34;</span> <span class="p">|</span> sudo tee -a /etc/environment
</span></span></code></pre></div>
      </div>
      








  
  
  
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

      
    
        

        
          
        

        
        


<footer id="article-footer">
  <time id="article-last-updated" datetime="2023-12-04"><i class="icon icon-calendar"></i>&nbsp;Last updated: 2023-12-04</time>

  
    <a id="article-prev-link" href="/containersecurity/docker-networking/"><i class="icon icon-prev icon-colored"></i> Prev</a>
  

  
    <a id="article-next-link"  href="/containersecurity/container-image-security/">Next <i class="icon icon-next icon-colored"></i></a>
  
</footer>
    </article>
    <aside id="toc">
  <span class="btn-close"><i class="icon icon-close"></i></span>
  <div class="sticky">
    <strong><i class="icon icon-toc"></i> On this page</strong>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#auditing-docker-security">Auditing Docker Security</a></li>
    <li><a href="#auditing-docker-security-with-docker-bench-for-security">auditing docker security with docker bench for security</a></li>
  </ul>

  <ul>
    <li><a href="#running-docker-bench-for-poticular-docker-images">Running Docker Bench for poticular docker images</a></li>
  </ul>

  <ul>
    <li><a href="#enable-content-trust">Enable Content Trust</a></li>
    <li><a href="#ensure-auditing-is-configured-for-various-docker-files">Ensure auditing is configured for various Docker files</a></li>
    <li><a href="#correcting-docker-daemon-configuration-warnings">Correcting Docker Daemon Configuration Warnings</a></li>
    <li><a href="#enable-content-trust-1">Enable Content Trust</a></li>
  </ul>
</nav>
  </div>
</aside>
  </main>
</div>

    <footer id="site-footer">
  
  <div id="site-footer-copyright">
    <a href="https://discord.gg/rEvr7vq" target="_blank">
      <i class="icon icon-copyright"></i> 2023 CloudNativeFolks
    </a>
  </div>

  
  <div id="site-footer-social">

    

    
    <a href="https://twitter.com/i/communities/1499311438745468931" target="_blank" aria-label="twitter url">
      <i class="icon icon-twitter icon-colored"></i>
    </a>
    

    
    <a href="https://github.com/sangam14" target="_blank" aria-label="github url">
      <i class="icon icon-github icon-colored"></i>
    </a>
    

    
    <a href="https://www.youtube.com/@CloudNativeFolks" target="_blank" aria-label="youtube url">
      <i class="icon icon-youtube icon-colored"></i>
    </a>
    

  </div>

  
  <center> <a href="https://visitorbadge.io/status?path=https%3A%2F%2Fkubedaily.com"><img src="https://api.visitorbadge.io/api/visitors?path=https%3A%2F%2Fkubedaily.com&label=KubeDaily&labelColor=%232ccce4&countColor=%2337d67a" /></a> </center> 

  
  <div id="site-footer-love">
    Made with <i class="icon icon-love icon-colored"></i> &nbsp;from&nbsp;<a href="https://blog.cloudnativefolks.org" target="_blank">@CloudNativeFollks</a>
  </div>
</footer>
    






<script type="text/javascript" src="/js/base.min.js"></script>



  
  <script src="/js/component/docsearch.min.js"></script>
  <script type="application/javascript">
      docsearch({
          container: '#site-header-search',
          appId: '',
          indexName: '',
          apiKey: '',
      });
  </script>


<script type="application/javascript">
    if('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js?2023-12-06')
            .catch(function(err) {console.error('ServiceWorker registration failed: ', err);});
    }
</script>
  </body>
</html>